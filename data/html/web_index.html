<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid</title>
</head>

<body>
    <textarea id="mermaidCode" style="display: none;">@@ASCIIBOX-NOBODYGX-PLACEHOLD@@</textarea>
    <textarea id="svgData" readonly style="display: none;"></textarea>
    <div style="height: 100vh; display: grid; place-items: center;">
        <div style="padding: 20px;" id="diagram">
        </div>
    </div>
    </div>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';

        mermaid.initialize({
            startOnLoad: false,
            theme: 'default'
        });

        // --- Get DOM Elements ---
        const mermaidCodeInput = document.getElementById('mermaidCode');
        const generateButton = document.getElementById('generateSvg');
        const svgData = document.getElementById('svgData');
        const diagram = document.getElementById('diagram');

        async function generateMermaidSVG() {
            if (svgData.value) {
                console.log("has value, exit.")
                return;
            }
            const mermaidCode = mermaidCodeInput.value.trim();
            svgData.value = '';
            if (!mermaidCode) {

                return;
            }
            try {
                const svgId = 'mermaid-diagram-' + Date.now();
                const { svg } = await mermaid.render(svgId, mermaidCode);
                svgData.value = svg;
                diagram.innerHTML = svg;
                console.log('SVG successfully generated and saved!');
            } catch (error) {
                console.error('Mermaid rendering error:', error);
                svgData.value = '';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            generateMermaidSVG();

            setTimeout(() => {
                generateMermaidSVG();
            }, 1500);
        });
    </script>
</body>
</html>
